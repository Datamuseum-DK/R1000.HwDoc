#!/usr/local/bin/python3.8
#
# NB: We strive to use y-x coordinate order to match numpy's convention

''' STEP 210: Locate And-ish, Or-ish and Inverter-ish elements '''

import sys

import numpy as np

import templates

PLANE_50 = '''
-----------------------------------------------------
------#######---###-                    -######------
------#######--##---                    -######------
      #######--####-                    -######      
      #######--####-                    -######      
------#######--####-                    -######------
--------------------                    -------------
-----------------------------------------------------
'''

PLANE_SCAN = '''
          ----------                                     ------------                                                -----                    -----                        ---                       ---------                                        -------          
          ---------                                       ---------                                                   ---                      ---                                                     ------                                          ------          
          --------                                         -------                                  ###                                                                                                -----                                            -----          
          -------                   #################       ------        #############          ##############                  ######                        ###                       ###            ----         ################                    ----          
          ------                   ###################      -----        ###############         ################               #######                       #####                     #####           ---         ###################                   ---          
          -----                  #####################       ---        ###############          ################              #########                     ######                    ######            -          ####################                   --          
          -----                  ######################      ---       ################          ################              #########                    #######                   #######            -         ######################                  --          
          -----                 #######################      --       #########                  ##########                    #########                   ########                   #######            -         ######################                  --          
          ----                 ########################      --      ########                     ######                       #########                       ###                        ##                       #######################                  -          
          - -                 #########################      -       #######                      #####                        ##     ##                                                                           ########################                            
                             ##########################      -       ######                       #####                                #                                                                           #########################                           
                            ###########################      -       ######                       #####                               ##                                                                           ##########################                          
                           ############################      -       ######                       #####                              ###                        ##                         #                       ############################                        
                         ##############################      -       #######                       #####                        ########                      #####                      ####                      ##############################                      
                     ##################################              #######   ########           ########                      ########                      #####                     ######                     ################################                    
                    ###################################              ###################           #######                      ########                      #####                      ####                      ################################                    
                    ###################################      -       ####################         #########                     ########                        ##                         ##                      ################################                    
                    ###################################      --      ####################         ########                      ########                                                                            ###############################                    
                     ##################################      -       #######   ##########         #######                       ########                                                                            ##############################                     
                          #############################      --      ######      ########         ######                        #####                                                                               ###########################                        
                           ############################      --      ######       #######         #####                         ###                                                                       -         #########################                          
                             ##########################      --      ######       #######         ####                          ##                                                                       -          ########################                           
                              #########################     ---      ######       #######         ###                           ##                                                                        -         #######################                            
          ----                 ########################      --       ######      #######         ###                           ##                                                                       --         ######################                 --          
          -----                 ######################      ---       ######      #######         ###                           ####                                                                     --         #####################                 ---          
          -----                  #####################      ----       #######  #########        ####                          ##########                                                               ---         ####################                  ---          
          ------                  ####################      -----       ################         ###                           ##########                                                              -----        ###################                  ----          
          ------                   ##################      ------        ###############         ###                           ##########                                                              -----         ################                   -----          
          -------                    ###############       -------        #############                                         #########                                                              ------          ######                           -----          
          ---------                                       ---------            #####                                               ####                                                               -------                                         -------          
          ----------                                      ----------                                                ---                                                    -                         ---------                                       --------          
          -----------                                    ------------                                              -----                        ---                       ----                       ----------                                     ---------          
'''

class Plane_Sheet(templates.Template_Sheet):

    def tagger(self, order, save, save_tl, save_br):
        shape = save.shape
        mid_y = shape[0] // 2
        mid_x = shape[1] // 2
        left = save[mid_y - 15 : mid_y + 15, mid_x - 150 : mid_x - 130]
        right = save[mid_y - 15 : mid_y + 15, mid_x + 130 : mid_x + 150]
        black_left = np.amin(left) < 0
        black_right = np.amin(right) < 0
        #left *= -.25
        #right *= -.25
        if black_left and not black_right:
            return "Plane,left"
        if black_right and not black_left:
            return "Plane,right"
        if not black_left and not black_right:
            return "Plane,none"
        return "Plane,both"

if __name__ == "__main__":
    sheet = Plane_Sheet(
        "plane",
        sys.argv,
        templates.string_2_template(PLANE_50),
        templates.string_2_template(PLANE_SCAN, black=-2),
        0.600,
        0.200,
    )
    sheet.load_raw_image()
    sheet.load_proj50_image()
    sheet.match() 
